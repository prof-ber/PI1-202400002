<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="stylesheet" href="jogo.css">
</head>
<body>
    <div class="header">
        <img src="..\assets\brain-clip-art.svg" alt="logo" id="logo">
        <h1>Vitrine da Mente</h1>
    </div>
    <div class="nav">
        <a href="index.html">In√≠cio</a>
            <a href="profissionais.html">Profissionais</a>
            <a href="jogo.html">Jogo da mem√≥ria</a>
            <a href="simples.html">P√°gina simples</a>
            <a href="palestras.html">Palestras</a>
    </div>
  
    <div id="app"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        const figuras = [ "üòÄ","üòÇ","üòç","ü§î","üòé","üò¢","üò°","üò±","üò¥","üò∑","ü§Ø","ü•≥","ü•∫","üòá","ü§ñ","üëΩ","üëª","üê±"];
        const descricoes = ["sorriso", "chorando de rir", "apaixonado", "pensativo", "de √≥culos escuros", "chorando", "zangado", "assustado", "dormindo", "doente", "cabe√ßa explodindo", "comemorando", "implorando", "angelical", "rob√¥", "alien√≠gena", "fantasma", "gato"];
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        function inicializarBaralho() {
            const baralho = [];
            let grupo = 0;
            figuras.forEach((figura, index) => {
                baralho.push({ id: index * 2, content: figura, matched: false, pairIndex: 0, group: grupo});
                baralho.push({ id: index * 2 + 1, content: descricoes[index], matched: false, pairIndex: 1, group: grupo});
                grupo++;
            });
            shuffleArray(baralho);
            return baralho;
        }
        function App() {
            const [cards, setCards] = useState(inicializarBaralho());
            const [cartasViradas, setCartasViradas] = useState([]);
            const [matches, setMatches] = useState([]);

            useEffect(() => {
                if (cartasViradas.length === 2) {
                    const match = cartasViradas[0].group === cartasViradas[1].group;
                    if (match) {
                        const newMatches = [...matches, cartasViradas[0].group]; // Store matched groups instead of content
                        setMatches(newMatches);
                        setCartasViradas([]);
                    } else {
                        setTimeout(() => setCartasViradas([]), 1000);
                    }
                }
            }, [cartasViradas, matches]);

            const handleClick = (id) => {
                const card = cards.find(card => card.id === id);
                if (cartasViradas.length < 2 && !cartasViradas.find(c => c.id === id)) {
                    setCartasViradas([...cartasViradas, card]);
                }
            };

            const resetGame = () => {
                setCards(inicializarBaralho());
                setCartasViradas([]);
                setMatches([]);
            };

            const isVictory = matches.length === figuras.length;

            const inicializarJogo = () => {
                return cards.map((card) => (
                    <Card
                        key={card.id}
                        id={card.id}
                        figura={card.content}
                        isMatched={matches.includes(card.group)} // Check if the card's group is in the matches array
                        isFlipped={cartasViradas.some(carta => carta.id === card.id) || matches.includes(card.group)} // Adjust flip condition
                        handleClick={handleClick}
                        group={card.group}
                    />
                ));
        };

            return (
                <>
                    <div className="jogo">
                        {inicializarJogo()}
                    </div>
                    {isVictory && (
                        <div className="victory-overlay">
                            <div className="victory-message">Parab√©ns! Voc√™ venceu!</div>
                            <button onClick={resetGame} className="reset-button">Reiniciar Jogo</button>
                        </div>
                    )}
                </>
            );
        }

        function Card({ figura, isMatched, handleClick, id, isFlipped, pairIndex }) {
            return(
                <div className={`card ${isFlipped || isMatched ? 'flipped' : ''} pair-${pairIndex}`} onClick={() => handleClick(id)}>
                    <span className="content">{isFlipped || isMatched ? figura : 'ü§î'}</span>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('app'));
    </script>
</body>
</html>