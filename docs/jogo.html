<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="stylesheet" href="jogo.css">
</head>
<body>
    <div id="app"></div>
    <script type="text/babel">
        const { useState, useEffect } = React; // Destructure useState and useEffect from React

        const figuras = [ "ðŸ˜€","ðŸ˜‚","ðŸ˜","ðŸ¤”","ðŸ˜Ž","ðŸ˜¢","ðŸ˜¡","ðŸ˜±","ðŸ˜´","ðŸ˜·","ðŸ¤¯","ðŸ¥³","ðŸ¥º","ðŸ˜‡","ðŸ¤–","ðŸ‘½","ðŸ‘»","ðŸ±"];
        const descricoes = ["sorriso", ]
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        function inicializarBaralho() {
            const baralho = [];
            figuras.forEach((figura, index) => {
                baralho.push({ id: index * 2, figura, matched: false, pairIndex: 0});
                baralho.push({ id: index * 2 + 1, figura, matched: false, pairIndex: 1});
            });
            shuffleArray(baralho);
            return baralho;
        }
        function App() {
            const [cards, setCards] = useState(inicializarBaralho());
            const [cartasViradas, setCartasViradas] = useState([]);
            const [matches, setMatches] = useState([]);

            useEffect(() => {
                if (cartasViradas.length === 2) {
                    const match = cartasViradas[0].figura === cartasViradas[1].figura;
                    if (match) {
                        setMatches([...matches, cartasViradas[0].figura]);
                        setCartasViradas([]);
                    } else {
                        setTimeout(() => setCartasViradas([]), 1000);
                    }
                }
            }, [cartasViradas, matches]);

            const handleClick = (id) => {
                const card = cards.find(card => card.id === id);
                if (cartasViradas.length < 2 && !cartasViradas.find(c => c.id === id)) {
                    setCartasViradas([...cartasViradas, card]);
                }
            };

            const resetGame = () => {
                setCards(inicializarBaralho());
                setCartasViradas([]);
                setMatches([]);
            };

            const isVictory = matches.length === figuras.length;

            const inicializarJogo = () => {
                return cards.map((card) => (
                    <Card
                        key={card.id}
                        id={card.id}
                        figura={card.figura}
                        isMatched={matches.includes(card.figura)}
                        isFlipped={cartasViradas.some(carta => carta.id === card.id) || matches.includes(card.figura)}
                        handleClick={handleClick}
                    />
                ));
            };

            return (
                <>
                    <div className="jogo">
                        {inicializarJogo()}
                    </div>
                    {isVictory && (
                        <div className="victory-overlay">
                            <div className="victory-message">ParabÃ©ns! VocÃª venceu!</div>
                            <button onClick={resetGame} className="reset-button">Reiniciar Jogo</button>
                        </div>
                    )}
                </>
            );
        }

        function Card({ figura, isMatched, handleClick, id, isFlipped, pairIndex }) {
            return(
                <div className={`card ${isFlipped || isMatched ? 'flipped' : ''} pair-${pairIndex}`} onClick={() => handleClick(id)}>
                    {isFlipped || isMatched ? figura : 'ðŸ¤”'}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('app'));
    </script>
</body>
</html>